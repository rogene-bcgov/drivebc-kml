name: Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.8, 3.9, "3.10", "3.11", "3.12"]

    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Run tests
      run: |
        python run_tests.py
    
    - name: Test KML generation and verify improvements
      run: |
        # Test that the converter can run without errors (using mock data)
        python -c "
        from drivebc_to_kml import DriveBCToKMLConverter
        converter = DriveBCToKMLConverter()
        # Test with sample data
        converter.events_data = [{
            'id': 'TEST-001',
            'event_type': 'CONSTRUCTION',
            'event_sub_type': 'ROAD_MAINTENANCE',
            'severity': 'MINOR',
            'status': 'ACTIVE',
            'description': 'Test event',
            'route_at': 'Test Highway',
            'location_description': 'Test Location',
            'closest_landmark': 'Test City',
            'direction': 'N',
            'last_updated': '2024-01-01T10:00:00-07:00',
            'next_update': None,
            'start': '2024-01-01T06:00:00-07:00',
            'end': '2024-01-01T18:00:00-07:00',
            'closed': False,
            'location': {'type': 'Point', 'coordinates': [-123.0, 49.0]}
        }]
        kml_content = converter.convert_to_kml()
        print('âœ… KML generation test passed')
        "
        
        # Run improvements verification
        python -m unittest test_drivebc_to_kml.TestImprovementsDemo.test_all_improvements_implemented
